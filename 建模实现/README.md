# 增强版源域数据集处理项目

## 🎯 项目概述

本项目完成了对161个源域轴承振动数据文件的增强版预处理流程，成功生成了322个标准化的数据片段，每个数据片段包含5个文件：去噪滤波后的原始数据、带标注的时域/频域可视化图像、29维特征向量以及主频和谐波成分分析，为后续的轴承故障诊断任务提供高质量的训练数据。

## ✨ 核心特性

### 🔧 多层次去噪滤波
- **高通滤波 (10Hz)**: 去除低频趋势和直流分量
- **低通滤波 (5000Hz)**: 去除高频噪声  
- **陷波滤波 (50Hz及谐波)**: 去除工频干扰
- **中值滤波 (3点核)**: 去除脉冲噪声

### 📊 全面特征提取 (29维)
- **时域特征 (P1-P16)**: 统计量、形状因子、变异系数
- **频域特征 (P17-P29)**: 频谱统计、主频带位置、频谱分散度

### 🎯 主频检测与谐波分析 (新增)
- **主频自动检测**: 识别信号中的主要频率成分
- **谐波成分分析**: 自动识别主频的整数倍谐波
- **理论故障频率计算**: 基于轴承参数计算BPFO、BPFI、BSF、FTF
- **频域图像标注**: 在图中清晰标注主频、谐波和理论故障频率

### 🎨 增强可视化
- **时域图像**: 包含RMS、峰值、峰峰值等统计信息
- **频域图像**: 标注主频、谐波、理论故障频率，添加图例说明
- **高质量输出**: 150 DPI，便于后续分析和展示

### 🔒 唯一文件夹命名
- **解决冲突**: 使用全局计数器确保每个文件夹名称唯一
- **分类明确**: 文件夹名包含数据类别、原始文件名、片段类型等信息
- **易于管理**: 标准化命名规则便于数据管理和检索

## 📊 数据分布

| 数据类别 | 数据片段数 | 占比 | 说明 |
|---------|-----------|------|------|
| 12kHz_DE | 120 | 37.3% | 12kHz驱动端数据 |
| 12kHz_FE | 90 | 27.9% | 12kHz风扇端数据 |
| 48kHz_DE | 104 | 32.3% | 48kHz驱动端数据 |
| 48kHz_Normal | 8 | 2.5% | 48kHz正常状态数据 |
| **总计** | **322** | **100%** | |

| 故障类型 | 数据片段数 | 占比 |
|---------|-----------|------|
| OR (外圈故障) | 154 | 47.8% |
| IR (内圈故障) | 80 | 24.8% |
| B (滚动体故障) | 80 | 24.8% |
| N (正常状态) | 8 | 2.5% |
| **总计** | **322** | **100%** |

## 📁 文件结构

```
建模实现/
├── 代码/
│   ├── step1_data_analysis.py          # 数据集分析工具
│   ├── enhanced_data_processor.py      # 增强版主处理程序
│   ├── final_verification.py           # 最终验证脚本
│   └── README.md                       # 技术文档
├── 处理后数据/
│   ├── processed_segments/             # 322个数据片段
│   │   ├── [类别]_[文件名]_[位置]_2048_[编号]/
│   │   │   ├── *_raw_data.npy         # 去噪后原始数据(2048点)
│   │   │   ├── *_time_domain.png      # 时域信号图像(带统计信息)
│   │   │   ├── *_frequency_domain.png # 频域信号图像(带主频标注)
│   │   │   ├── *_features.csv         # 29维特征+故障标签
│   │   │   └── *_frequency_analysis.csv # 主频和谐波分析
│   │   └── ... (322个文件夹)
│   └── reports/
│       ├── processing_report.txt       # 处理报告(文本)
│       ├── processing_report.json      # 处理报告(JSON)
│       ├── all_features_summary.csv    # 所有特征汇总
│       └── all_frequency_analysis_summary.csv # 所有频率分析汇总
```

## 📈 特征说明

### 时域特征 (P1-P16)
- **P1**: 均值 - 信号直流分量
- **P2**: 均方根值 - 信号有效值
- **P3**: 方根幅值 - 信号强度指标
- **P4**: 绝对平均值 - 信号平均幅度
- **P5**: 最大值 - 信号峰值
- **P6**: 最小值 - 信号谷值
- **P7**: 峰峰值 - 信号动态范围
- **P8**: 方差 - 信号离散程度
- **P9**: 偏度 - 信号分布不对称性
- **P10**: 峰度 - 信号分布尖锐程度
- **P11**: 形状因子 - RMS与平均值比
- **P12**: 峰值因子 - 峰值与RMS比
- **P13**: 脉冲因子 - 峰值与平均值比
- **P14**: 变异系数 - 标准差与均值比
- **P15**: 偏度系数 - 归一化偏度
- **P16**: 峰度系数 - 归一化峰度

### 频域特征 (P17-P29)
- **P17**: 平均频率 - 频谱重心
- **P18**: 频谱方差 - 频谱分散程度
- **P19**: 频谱偏度 - 频谱分布不对称性
- **P20**: 频谱峰度 - 频谱分布尖锐程度
- **P21**: 频率重心 - 同P17
- **P22**: 频率标准差 - 频谱离散程度
- **P23**: 频率均方根 - 频谱有效值
- **P24-P25**: 主频带位置指示器 - 最强和次强频率成分
- **P26-P29**: 频谱分散度和集中度指示器 - 频谱形状特征

### 频率分析特征 (新增)
- **主频信息**: 频率值、幅值
- **谐波分析**: 谐波阶次、频率、幅值、幅值比
- **理论故障频率**: BPFO、BPFI、BSF、FTF (基于轴承参数和转速计算)

## 🚀 使用方法

### 环境要求
- Python 3.12+
- 必需包: numpy, scipy, matplotlib, pandas

### 安装依赖
```bash
pip install numpy scipy matplotlib pandas
```

### 运行流程

1. **数据分析** (可选)
```bash
python step1_data_analysis.py
```

2. **增强版数据处理** (主程序)
```bash
python enhanced_data_processor.py
```

3. **结果验证** (推荐)
```bash
python final_verification.py
```

## 🔬 技术规格

- **编程语言**: Python 3.12+
- **输入格式**: MATLAB .mat文件 (161个)
- **输出格式**: NumPy .npy, PNG图像, CSV表格
- **处理时间**: 约15-20分钟
- **存储需求**: 约800MB (包含高质量图像)
- **数据片段**: 2048点 @ 12kHz (约0.17秒)

## 📋 质量保证

✅ **数据完整性**: 所有161个源文件成功处理，生成322个数据片段  
✅ **文件完整性**: 每个数据片段都包含5个必需文件  
✅ **命名唯一性**: 使用全局计数器确保文件夹名称无冲突  
✅ **特征有效性**: 所有29个特征值都在合理范围内  
✅ **频率分析**: 主频检测和谐波分析功能正常工作  
✅ **可视化质量**: 图像清晰，标注准确，信息丰富  
✅ **处理可追溯**: 完整记录所有处理参数和流程  

## 🎯 主要改进

### 相比初版的关键改进
1. **解决文件夹冲突**: 使用唯一编号系统，确保322个文件夹都能正确生成
2. **增加主频检测**: 自动识别信号主要频率成分
3. **增加谐波分析**: 识别和分析主频的谐波成分
4. **理论频率计算**: 基于轴承参数计算理论故障频率
5. **图像增强标注**: 在频域图中标注主频、谐波和理论故障频率
6. **新增分析文件**: 每个数据片段包含频率分析CSV文件
7. **完善验证机制**: 全面的结果验证和质量检查

## 🔮 后续应用

### 机器学习
- 使用 `*_features.csv` 文件训练传统机器学习模型
- 29个精心设计的特征适用于各种分类算法

### 深度学习  
- 使用 `*_raw_data.npy` 文件进行端到端训练
- 1D CNN、LSTM等模型的理想输入格式

### 信号分析
- 使用带标注的可视化图像进行模式识别
- 主频和谐波信息有助于故障机理研究

### 频率域诊断
- 利用频率分析文件进行基于频率特征的故障诊断
- 理论故障频率为故障类型判断提供参考

### 数据增强
- 基于主频和谐波信息进行数据增强
- 为小样本故障类型生成更多训练数据

## 📞 技术支持

如有问题或建议，请参考：
- 代码注释中的详细说明
- `reports/processing_report.txt` 中的处理日志
- 验证脚本的输出信息

---

**项目完成时间**: 2025年9月23日  
**处理数据量**: 161个源文件 → 322个数据片段  
**总文件数**: 1,610个 (322 × 5)  
**特征维度**: 29维时域+频域特征 + 频率分析  
**数据完整性**: 100%
